---
- name: OSX Setup
  hosts: 127.0.0.1
  connection: local
  become: true
  become_user: "{{ lookup('env', 'USER') }}"
  gather_facts: true
  vars_prompt:
    - name: email
      prompt: What's your email?
      default: axelyung@gmail.com
      private: false
    - name: gh_username
      prompt: What's your GitHub username?
      default: axelyung
      private: false
    - name: ssh_key_passphrase
      prompt: SSH key passphrase? (leave blank to skip)
      private: true
  pre_tasks:
    - name: Include vars
      ansible.builtin.include_vars: "{{ item }}"
      with_fileglob:
        - "{{ playbook_dir }}/vars/*.yml"
      tags: [always]
  roles:
    - role: elliotweiser.osx-command-line-tools
      tags: [pkgs, xcode]
    - role: geerlingguy.mac.homebrew
      tags: [pkgs, homebrew]
  tasks:
    - name: Setup
      ansible.builtin.import_tasks: tasks/setup.yml
      tags: [setup]
    - name: Sudoers
      ansible.builtin.import_tasks: tasks/sudoers.yml
      tags: [sudoers]
    - name: Terminfo
      ansible.builtin.import_tasks: tasks/terminfo.yml
      tags: [terminfo]
    - name: Crypto
      ansible.builtin.import_tasks: tasks/crypto.yml
      tags: [crypto]
    - name: Node
      ansible.builtin.import_tasks: tasks/node.yml
      tags: [pkgs, node]
    - name: Dotfiles
      ansible.builtin.import_tasks: tasks/dotfiles.yml
      tags: [dotfiles]
